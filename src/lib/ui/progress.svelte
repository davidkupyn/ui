<script script lang="ts" context="module">
	const progressStyles = tv({
		slots: {
			base: 'relative h-2 w-full overflow-hidden rounded-full',
			indicator:
				'h-full w-full rounded-full transition-transform duration-500 ease-in-out shadow-[inset_0_1px_0_#ffffff4d]'
		},
		variants: {
			variant: {
				default: {
					base: 'bg-primary-500/20',
					indicator: 'bg-primary dark:dark:shadow-[inset_0_-1px_0_#0000004d]'
				},
				accent: {
					base: 'bg-accent-500/20',
					indicator: 'bg-accent'
				},
				success: {
					base: 'bg-success-500/20',
					indicator: 'bg-success'
				},
				error: {
					base: 'bg-error-500/20',
					indicator: 'bg-error'
				},
				warning: {
					base: 'bg-warning-500/20',
					indicator: 'bg-warning'
				},
				info: {
					base: 'bg-info-500/20',
					indicator: 'bg-info'
				}
			}
		}
	});
</script>

<script lang="ts">
	import { cn } from '$lib/helpers/style';
	import { createProgress } from '@melt-ui/svelte';
	import { createEventDispatcher } from 'svelte';
	import { tv, type VariantProps } from 'tailwind-variants';
	export let value: number;
	export let variant: VariantProps<typeof progressStyles>['variant'] = 'default';
	export let max = 100;
	let className: string | undefined | null = undefined;
	export { className as class };
	const {
		elements: { root },
		states: { value: valueStore },
		options: { max: maxStore }
	} = createProgress({
		defaultValue: value,
		onValueChange: ({ next }) => {
			value = next;
			dispatch('change', next);
			return next;
		},
		max
	});
	const dispatch = createEventDispatcher();
	$: valueStore.set(value);
	$: maxStore.set(max);

	const { base, indicator } = progressStyles({ variant });
</script>

<div use:root {...$root} class={cn(base(), className)}>
	<div
		class={indicator()}
		style={`transform: translateX(-${100 - (100 * ($valueStore ?? 0)) / ($maxStore ?? 1)}%)`}
	/>
</div>
